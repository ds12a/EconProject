<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Econ Project</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
      <link rel="stylesheet" href="../static/styles.css">
       <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
   </head>
   <body>
      <div id="particles-js"> </div>
       
      <div id="conversation" class="container mx-auto p-5 text-center">
          <h1 class="display-1"> Welcome! </h1>
      </div>
</div>
    <div class="container">
      <div class="navbar fixed-bottom">
         <form class="container-fluid" id="promptForm" method="POST" action= "{{ url_for("index") }}">
         <div class="input-group">
            <span class="input-group-text">Prompt:</span><br><input onFocus="this.select()" class="form-control" placeholder="What happens next?" type="text" id="prompt" name="prompt"><br>
            <button type="submit" form="promptForm" value="Submit" id="subBtn">&#8593;    </button>
         </div>
         </form>
      </div>
    </div>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
   </body>
   <script src="{{url_for('static',filename='../static/script.js')}}"></script>
   <script>
      let conversation = new FormData();
      conversation.append("init", "Welcome!");
      let form = document.getElementById("promptForm");
      form.addEventListener('submit', function(event) {
          event.preventDefault();    // prevent page from refreshing
          const formData = new FormData(form);  // grab the data inside the form fields

          if (formData.get("prompt").trim().length > 0) {
              conversation.append("user", formData.get("prompt"));

              document.getElementById('prompt').value = '';
              document.getElementById('prompt').disabled = true;
              
              fetch('/', {   // assuming the backend is hosted on the same server
                  method: 'POST',
                  body: conversation,
              }).then((response) => response.text()).then(function(text) {
                  conversation.append("server", text);
                  displayConversation(conversation);
                  document.getElementById('prompt').disabled = false;
              });
          }
          
      });

       particlesJS.load('particles-js', './static/particlesjs-config.json', function() {
      console.log('callback - particles.js config loaded');});

   </script>
</html>